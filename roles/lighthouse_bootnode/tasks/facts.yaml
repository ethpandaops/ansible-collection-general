- name: Read ENR from generated enr.dat file
  ansible.builtin.slurp:
    src: "{{ lighthouse_bootnode_datadir }}/beacon/network/enr.dat"
  register: lighthouse_bootnode_enr_file

- name: Set fact "cl_bootnode_fact_enr" (for compatibility)
  ansible.builtin.set_fact:
    cl_bootnode_fact_enr: "{{ lighthouse_bootnode_enr_file.content | b64decode | trim }}"
    cacheable: true

- name: Set fact "lighthouse_bootnode_fact_enr"
  ansible.builtin.set_fact:
    lighthouse_bootnode_fact_enr: "{{ lighthouse_bootnode_enr_file.content | b64decode | trim }}"
    cacheable: true

- name: Write bootstrap_nodes.yaml to testnet config
  ansible.builtin.copy:
    content: |
      # Bootstrap nodes for {{ ethereum_network_name | default('testnet') }}
      # Generated by lighthouse_bootnode role
      - {{ lighthouse_bootnode_enr_file.content | b64decode | trim }}
    dest: "{{ lighthouse_bootnode_testnet_config_dir }}/bootstrap_nodes.yaml"
    mode: "0644"
  when: lighthouse_bootnode_testnet_config_dir | length > 0
