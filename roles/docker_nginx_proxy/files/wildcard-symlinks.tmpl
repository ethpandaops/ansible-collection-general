#!/bin/sh
# Autogenerated by docker-gen. Do not edit.
set -eu
WCRT="/etc/nginx/certs/{{ env "WILDCARD_CERT_NAME" }}.crt"
WKEY="/etc/nginx/certs/{{ env "WILDCARD_CERT_NAME" }}.key"
if [ ! -s "$WCRT" ] || [ ! -s "$WKEY" ]; then
echo "Wildcard cert/key not present: $WCRT / $WKEY" >&2
exit 0
fi
{{ $seen := dict }}
{{ range $container := where $ "Env.VIRTUAL_HOST" ".+" }}
  {{ $raw := index $container.Env "VIRTUAL_HOST" }}
  {{ $first := first (split $raw "\n") }}
  {{ $hosts := split $first "," }}
  {{ range $h := $hosts }}
    {{ $host := trim $h }}
    {{ if and $host (not (has $seen $host)) }}
ln -sf "./$WCRT" "$CERTSDIR/${host}.crt"
ln -sf "./$WKEY" "$CERTSDIR/${host}.key"
    {{ $_ := set $seen $host true }}
    {{ end }}
  {{ end }}
{{ end }}